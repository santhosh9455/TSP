<div class="p-6 w-full  mx-auto bg-white rounded-xl">

  <!-- Search and Add User -->
  <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
    <input [(ngModel)]="search" (ngModelChange)="onSearch($event)" placeholder=" Search by Users"
      class="sm:w-full md:w-1/2 lg:w-2xl placeholder-gray-600 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-900 transition" />

    <button (click)="newUserModel()" title="Add New User"
      class="flex items-center cursor-pointer lg:mr-30 gap-2 text-white bg-gradient-to-r hover:shadow-xl/10 from-green-400 via-green-500 to-green-600 hover:from-green-500 hover:to-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 dark:focus:ring-green-800 font-bold rounded-4xl text-sm px-5 py-3">

      <svg class="w-5 h-5  text-white" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
        <path fill-rule="evenodd"
          d="M9 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm-2 9a4 4 0 0 0-4 4v1a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-1a4 4 0 0 0-4-4H7Zm8-1a1 1 0 0 1 1-1h1v-1a1 1 0 1 1 2 0v1h1a1 1 0 1 1 0 2h-1v1a1 1 0 1 1-2 0v-1h-1a1 1 0 0 1-1-1Z"
          clip-rule="evenodd" />
      </svg>
      Add User
    </button>

  </div>

  <!-- Users Table -->
  <div>
    <table class="w-full shadow-md rounded-lg">
      <!-- ✅ Table Header -->
      <thead class="bg-purple-700 text-white">
        <tr>
          <th class="px-6 py-3 text-left text-sm font-semibold">#</th>
          <th class="px-6 py-3 text-left text-sm font-semibold">Username</th>
          <th class="px-6 py-3 text-left text-sm font-semibold">Role</th>
          <th class="px-6 py-3 text-center text-sm font-semibold">Actions</th>
        </tr>
      </thead>

      <!-- ✅ Table Body -->
      <tbody class=" divide-y divide-gray-200 shadow-md ">
        <ng-container *ngFor="let user of users; let i = index">
          <!-- Normal Row -->
          <tr class="hover:bg-purple-100 transition-all duration-150">
            <td class="px-6 py-3 text-sm text-gray-700">{{ i + 1 }}</td>
            <td class="px-6 py-3 font-medium text-gray-800">{{ user.username }}</td>
            <td class="px-6 py-3">
              <span class="inline-block px-3 py-1 text-xs font-semibold rounded-full" [ngClass]="{
                'bg-purple-400 text-black': user.role === 'ROLE_ADMIN',
                'bg-purple-700 text-white': user.role === 'ROLE_STAFF',
                'bg-green-600 text-white': user.role === 'ROLE_STUDENT',
                'bg-amber-400 text-black': user.role === 'ROLE_HOD'
              }">
                {{ user.role.startsWith('ROLE_') ? user.role.substring(5) : user.role || 'Unknown' }}
              </span>
            </td>
            <td class="px-6 py-3 flex items-center justify-center gap-4">
              <!-- Edit -->
              <button title="Edit" class="cursor-pointer" (click)="toggleExpand(user)">
                <svg class="w-6 h-6 text-amber-300 ml-3 dark:text-amber-300" aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                  <path fill-rule="evenodd"
                    d="M14 4.182A4.136 4.136 0 0 1 16.9 3c1.087 0 2.13.425 2.899 1.182A4.01 4.01 0 0 1 21 7.037c0 1.068-.43 2.092-1.194 2.849L18.5 11.214l-5.8-5.71 1.287-1.31.012-.012Zm-2.717 2.763L6.186 12.13l2.175 2.141 5.063-5.218-2.141-2.108Zm-6.25 6.886-1.98 5.849a.992.992 0 0 0 .245 1.026 1.03 1.03 0 0 0 1.043.242L10.282 19l-5.25-5.168Zm6.954 4.01 5.096-5.186-2.218-2.183-5.063 5.218 2.185 2.15Z"
                    clip-rule="evenodd" />
                </svg>
              </button>

              <!-- Delete -->
              <button title="Delete" class="cursor-pointer" (click)="deleteUser(user)">
                <svg class="w-6 h-6 text-red-600 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                  width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                  <path fill-rule="evenodd"
                    d="M8.586 2.586A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4a2 2 0 0 1 .586-1.414ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z"
                    clip-rule="evenodd" />
                </svg>
              </button>
            </td>
          </tr>

          <!-- Expandable Row for Editing -->
          <tr *ngIf="expandedUser?.id === user.id" class="bg-gray-50">
            <td colspan="4" class="px-6 py-4">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Username -->
                <div class="flex flex-col">
                  <label for="username" class="text-sm font-medium text-gray-700 mb-1">Username</label>
                  <input [(ngModel)]="expandedUser.username" id="username" placeholder="Username"
                    class="px-4 py-2 border rounded-lg w-full focus:ring-2 focus:ring-purple-500 focus:outline-none" />
                </div>

                <!-- Password -->
                <div class="flex flex-col">
                  <label for="password" class="text-sm font-medium text-gray-700 mb-1">Password</label>
                  <div class="relative">
                    <input [(ngModel)]="expandedUser.password" id="password" [type]="showPassword ? 'text' : 'password'"
                    placeholder="Password"
                    class="px-4 py-2 border rounded-lg w-full focus:ring-2 focus:ring-purple-500 focus:outline-none" />
                  <!-- Eye Icon -->
                  <button type="button" (click)="togglePassword()"
                    class="absolute cursor-pointer inset-y-0 right-0 flex items-center px-3 text-gray-800 dark:text-gray-300">
                    <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                      viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0zm-9.88 2.12a9.94 9.94 0 01-1.12-2.12 10.05 10.05 0 0116 0c-.27.59-.62 1.13-1.03 1.61M4.12 16.88A9.941 9.941 0 0112 21c2.21 0 4.25-.72 5.88-1.88M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                      viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13.875 18.825A10.05 10.05 0 0112 19c-2.21 0-4.25-.72-5.88-1.88M6.28 6.28a9.94 9.94 0 00-2.16 2.12 10.05 10.05 0 0016 0c-.27-.59-.62-1.13-1.03-1.61M3 3l18 18" />
                    </svg>
                  </button>
                  </div>
                  
                </div>

                <!-- Role -->
                <div class="flex flex-col">
                  <label for="role" class="text-sm font-medium text-gray-700 mb-1">Role</label>
                  <select [(ngModel)]="expandedUser.roleId" id="role"
                    class="px-4 py-2 border rounded-lg w-full focus:ring-2 focus:ring-purple-500 focus:outline-none">
                    <option *ngFor="let role of roles" [value]="role.id">{{ role.role.replace('ROLE_', '') }}</option>
                  </select>
                </div>

                <!-- Actions -->
                <div class="flex items-end gap-2 justify-end">
                  <button (click)="saveUser(expandedUser)" title="Save User"
                    class="px-4 py-2 rounded-lg cursor-pointer bg-green-600 text-white hover:bg-green-700 transition">
                    Save
                  </button>
                  <button (click)="cancelEdit()"
                    class="px-4 py-2 cursor-pointer rounded-lg bg-gray-400 text-white hover:bg-gray-500 transition">
                    Cancel
                  </button>
                </div>
              </div>
            </td>
          </tr>

        </ng-container>
      </tbody>
    </table>

    <!-- No Users -->
    <ng-template #noRequested>
      <p class="bg-blue-300 p-2 text-center">No users found.</p>
    </ng-template>
  </div>


  <!-- Pagination Controls -->
  <div class="mt-6 flex justify-between items-center">
    <button (click)="previousPage()" [disabled]="page === 0"
      class="px-4 py-2 rounded-full bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50 disabled:cursor-not-allowed transition">
      Previous
    </button>

    <span class="text-sm text-gray-600">Page {{ page + 1 }} of {{ totalPages }}</span>
    <div>
      <label class="text-sm text-gray-600" for="size">Record Size : </label>
      <select (ngModelChange)="onPageSizeChange($event)" [(ngModel)]="size"
        class="border-2 text-gray-600 px-6 py-1 rounded-2xl" name="size" id="size">
        <option [value]="5">5</option>
        <option [value]="10">10</option>
        <option [value]="20">20</option>
      </select>
    </div>

    <button (click)="nextPage()" [disabled]="page >= totalPages - 1"
      class="px-4 py-2 rounded-full bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50 disabled:cursor-not-allowed transition">
      Next
    </button>
  </div>

  <app-new-user></app-new-user>
</div>