<div class="p-6 w-full mx-auto mt-4 bg-white">
    <!-- Header with search + Add button -->
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold text-gray-700">Students</h2>
        <div class="flex space-x-3 items-center">
            <div>
                <select class="p-2 border border-gray-300 outline-none rounded-lg" name="yearOfStudy" id="yearOfStudy"
                    [(ngModel)]="selectedYear" (change)="fetchStudents()">
                    <option value="">All Students</option>
                    <option *ngFor="let year of yearOfStudy" [value]="year">{{ year }}</option>
                </select>
            </div>
            <div>
                <ng-select [items]="departments" bindLabel="departmentName" bindValue="id" placeholder="All Departments"
                    [searchable]="true" [clearable]="true" [(ngModel)]="departmentId" (ngModelChange)="fetchStudents()"
                    class="w-64 px-3 py-2 border border-gray-300 rounded-md focus:outline-none cursor-pointer focus:ring-2">
                </ng-select>
            </div>
            <div class="relative">
                <i class="pi pi-search absolute left-3 top-3 text-gray-400"></i>
                <input type="text" placeholder="Search students..." [(ngModel)]="search" (input)="fetchStudents()"
                    class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 outline-none" />
            </div>
            <button class="bg-purple-600 cursor-pointer text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                Add Student
            </button>
        </div>
    </div>

    <!-- Table -->
    <table class="w-full shadow-md rounded-lg">
        <thead>

            <tr class="bg-purple-700 text-white">
                <th class="px-4 py-2 text-left">
                    <!-- Modern select-all checkbox -->
                    <input type="checkbox" class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"
                        [checked]="isAllSelected()" [indeterminate]="isIndeterminate()"
                        (change)="toggleSelectAll($event)" />
                    <span class="ml-2">S.NO</span>
                </th>
                <th class="px-6 py-3 text-left cursor-pointer" (click)="toggleSort('firstName')">
                    Name
                    <span *ngIf="sortField === 'firstName'">
                        {{ sortOrder === 'asc' ? '▲' : '▼' }}
                    </span>
                </th>
                <th class="px-6 py-3 text-left cursor-pointer" (click)="toggleSort('username')">
                    Username
                    <span *ngIf="sortField === 'username'">
                        {{ sortOrder === 'asc' ? '▲' : '▼' }}
                    </span>
                </th>
                <th class="px-6 py-3 text-left cursor-pointer" (click)="toggleSort('yearOfStudy')">
                    Class
                    <span *ngIf="sortField === 'yearOfStudy'">
                        {{ sortOrder === 'asc' ? '▲' : '▼' }}
                    </span>
                </th>
                <th class="px-6 py-3 text-left cursor-pointer" (click)="toggleSort('dateOfBirth')">
                    Date of Birth
                    <span *ngIf="sortField === 'dateOfBirth'">
                        {{ sortOrder === 'asc' ? '▲' : '▼' }}
                    </span>
                </th>
                <th class="px-6 py-3 text-left cursor-pointer" (click)="toggleSort('departmentName')">
                    Department
                    <span *ngIf="sortField === 'departmentName'">
                        {{ sortOrder === 'asc' ? '▲' : '▼' }}
                    </span>
                </th>
                <th>
                    <span>Actions</span>
                </th>
            </tr>
        </thead>
        <tbody class="divide-gray-200 shadow-md rounded-lg">
            <tr *ngFor="let student of studentsList let i = index" class="border-b hover:bg-gray-200">
                <td class="px-4 py-2">
                    <!-- Row checkbox -->
                    <input type="checkbox"
                        class="w-4 h-4 text-purple-600 border-gray-300 rounded-4xl focus:ring-purple-500"
                        [checked]="isSelected(student)" (change)="toggleStudentSelection(student, $event)" />
                    <span class="ml-2">{{ i + 1 }}</span>
                </td>
                <td class="px-6 py-3">
                    {{ student.firstName + ' ' + student.lastName }}
                </td>
                <td class="px-6 py-3">{{ student.username }}</td>
                <td class="px-6 py-3">{{ student.yearOfStudy }}</td>
                <td class="px-6 py-3">{{ student.dateOfBirth | date: 'dd-MM-yyyy' }}</td>
                <td class="px-6 py-3">{{ student.departmentName }}</td>
                <td>
                    <button (click)="viewStudents(student)" title="View" class="cursor-pointer mr-4">
                        <svg class="w-6 h-6 text-green-500 dark:text-white" aria-hidden="true"
                            xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                            <path stroke="currentColor" stroke-width="2"
                                d="M21 12c0 1.2-4.03 6-9 6s-9-4.8-9-6c0-1.2 4.03-6 9-6s9 4.8 9 6Z" />
                            <path stroke="currentColor" stroke-width="2" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        </svg>

                    </button>
                    <button (click)="deleteStudent(student)" title="Delete" class="cursor-pointer">
                        <svg class="w-6 h-6 text-red-600 dark:text-white" aria-hidden="true"
                            xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                            viewBox="0 0 24 24">
                            <path fill-rule="evenodd"
                                d="M8.586 2.586A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4a2 2 0 0 1 .586-1.414ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </td>
            </tr>
            <tr *ngIf="studentsList.length === 0">
                <td colspan="5" class="text-center py-4 text-gray-500">
                    No students found.
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Pagination -->
    <div class="flex justify-between items-center mt-4">
        <div class="flex items-center space-x-2">
            <label for="pageSize" class="text-sm text-gray-600">Rows per page:</label>
            <select id="pageSize" [(ngModel)]="size" (change)="changePageSize($any($event.target).value)"
                class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 outline-none">
                <option *ngFor="let s of sizes" [value]="s">{{ s }}</option>
            </select>

            <div>
                <button (click)="downloadReport()" [disabled]="selectedStudents.length === 0" title="Download report"
                    class="px-4 py-2 rounded-full cursor-pointer hover:bg-gray-200 disabled:hover:bg-gray-200 disabled:cursor-not-allowed">
                    <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 15v2a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3v-2m-8 1V4m0 12-4-4m4 4 4-4" />
                    </svg>
                </button>
            </div>
        </div>


        <div class="flex items-center space-x-4">
            <button (click)="changePage(page - 1)" [disabled]="page === 0"
                class="px-4 py-2 bg-gray-200 rounded-lg cursor-pointer hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                Previous
            </button>
            <span class="text-sm"> Page {{ page + 1 }} of {{ totalPages }} </span>
            <button (click)="changePage(page + 1)" [disabled]="page + 1 >= totalPages"
                class="px-4 py-2 bg-gray-200 rounded-lg cursor-pointer hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                Next
            </button>
        </div>
    </div>


</div>

